<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd">
	<sub-flow name="employee-ehr-odata-implementationSub_Flow" doc:id="64917f06-804f-41eb-93b6-ac96e7d330cd" >
		<set-variable value="#[output application/java
&#10;---
&#10;&quot;PickListV2_id eq '$(vars.bureau.country)' and externalCode eq '$(vars.bureau.code)'&quot;]" doc:name="set-filters" doc:id="36da22df-e5de-49b6-8980-1953644165fa" variableName="setFilter"/>
		<http:request method="GET" doc:name="Employee ID Post Request" doc:id="706a1588-fae7-4e30-aaeb-2afa9f4f1dfb" config-ref="HTTP_Request_odata" path="${ehr.cityCode.path}">
			<http:query-params ><![CDATA[#[output application/java
---
{
	'\$filter' : vars.setFilter
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="convert-to-json" doc:id="70037869-e7d5-4150-97b8-be9db131a7ef" >
			<ee:message >
				<ee:set-payload resource="dwl/convertToJson.dwl" />
			</ee:message>
		</ee:transform>
		<json-logger:logger doc:name="log-payload" doc:id="377957e6-2026-4039-a569-0900e6c9f230" config-ref="JSON_Logger_Config" message='#["CITY RETRIEVED FOR COUNTRY: " ++ vars.bureau.country ++ " CODE: " ++ vars.bureau.code]' tracePoint="AFTER_REQUEST" category="com.louisvuitton.technical" priority="DEBUG">
			<json-logger:content ><![CDATA[#[output application/json indent = false ---
payload]]]></json-logger:content>
		</json-logger:logger>
	</sub-flow>
	<sub-flow name="get-legal-entity" doc:id="b918e358-fcdb-4c1d-8e30-bb974e67bf8f" >
		<json-logger:logger doc:name="Received Request for Legal entity" doc:id="0659faa1-26bf-443f-8425-c606453e84e5" config-ref="JSON_Logger_Config" message="Received Request for Legal entity" tracePoint="BEFORE_REQUEST" category="${log.external.categoryAdditivityEnabled}" >
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json indent = false ---
{
    "Legal entity code": attributes.headers.legalEntityCode
}]]]></json-logger:content>
		</json-logger:logger>
		<http:request method="GET" doc:name="GET /legalEntity" doc:id="7a1b4655-4044-47da-b749-bbcbac14ffa7" config-ref="HTTP_Request_odata" sendCorrelationId="ALWAYS" correlationId="#[correlationId]" path="${ehr.legalEntity.path}">
			<http:query-params ><![CDATA[#[vars.queryParams]]]></http:query-params>
		</http:request>
		<json-logger:logger doc:name="Response for Legal entity" doc:id="fb9452b6-b811-4427-bf56-9f595c33ed00" config-ref="JSON_Logger_Config" tracePoint="AFTER_REQUEST" priority="DEBUG" category="com.louisvuitton.technical" message="Response for Legal entity"/>
	</sub-flow>
	<sub-flow name="get-work-experience" doc:id="98bf4fb5-86b1-4c95-b9a4-26af6e37a2ba" >
		<json-logger:logger doc:name="Received Request for Outside work experience" doc:id="8d65dfc2-f45d-4b12-bcef-ebb853f8c9c8" config-ref="JSON_Logger_Config" message="Received Request for Outside work experience" tracePoint="BEFORE_REQUEST" category="${log.external.categoryAdditivityEnabled}" >
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json indent = false ---
{
    "Query param filter": vars.filterWork
}]]]></json-logger:content>
		</json-logger:logger>
		<http:request method="GET" doc:name="GET / workExperience" doc:id="770b8e56-ab64-437f-a3c8-4371300f2f80" targetValue="#[output application/json indent = false --- payload]" config-ref="HTTP_Request_Odata_Work_Experience" path="${ehr.workExperience.path}" sendCorrelationId="ALWAYS" correlationId="#[correlationId]">
			<http:query-params ><![CDATA[#[output application/java
---
{
	'\$filter' : vars.filterWork
}]]]></http:query-params>
		</http:request>
		<json-logger:logger doc:name="Response for Outside work experience" doc:id="c944f21f-84b7-4fb7-a376-36d1b6f37391" config-ref="JSON_Logger_Config" message="Response for Outside work experience" tracePoint="AFTER_REQUEST" priority="DEBUG" category="com.louisvuitton.technical" />
	</sub-flow>
	<sub-flow name="get-degree" doc:id="ec3f9249-eb48-4c90-bb2f-7520fc552d48" >
		<json-logger:logger doc:name="Received Request for Education" doc:id="ca74f6fe-712c-4b72-8c31-6f9c7234e334" config-ref="JSON_Logger_Config" message="Received Request for Background Education" tracePoint="BEFORE_REQUEST" category="${log.external.categoryAdditivityEnabled}" >
			<json-logger:content ><![CDATA[#[import modules::JSONLoggerModule output application/json indent = false ---
{
    "Query param filter": vars.filterDegree,
    "Query param select": vars.selectDegree,
    "Query param expand": vars.expandDegree
}]]]></json-logger:content>
		</json-logger:logger>
		<http:request method="GET" doc:name="GET / degree" doc:id="e72fd57b-e918-4efc-8a1e-7822ea798ac9" config-ref="HTTP_Request_odata" path="${ehr.degree.path}" sendCorrelationId="ALWAYS" correlationId="#[correlationId]" targetValue="#[output application/json indent = false --- payload]" >
			<http:query-params ><![CDATA[#[output application/java
---
{
	'\$filter' : vars.filterDegree,
	'\$select' : vars.selectDegree,
	'\$expand' : vars.expandDegree
}]]]></http:query-params>
		</http:request>
		<json-logger:logger doc:name="Response for Education" doc:id="85f6816d-aea5-4c6c-8520-ef4dd55fd42d" config-ref="JSON_Logger_Config" message="Response for Background Education" tracePoint="AFTER_REQUEST" priority="DEBUG" category="com.louisvuitton.technical" />
	</sub-flow>
	<sub-flow name="get-pickllist" doc:id="231ddced-0f8e-41ed-86d9-a288abd82005" >
		<json-logger:logger doc:name="queryParams for externalCode" doc:id="b6275a3e-4893-4a39-9cb1-cf525c67b9ab" config-ref="JSON_Logger_Config" message="queryParams for externalCode" category="${log.external.categoryAdditivityEnabled}">
			<json-logger:content><![CDATA[#[import modules::JSONLoggerModule 
output application/json indent = false
---
vars.queryParams]]]></json-logger:content>
		</json-logger:logger>
		<set-variable value="#[output application/java
---
&quot;PickListV2_id eq '$(vars.queryParams.picklistId)' and externalCode eq '$(vars.queryParams.externalCode)'&quot;]" doc:name="set filter" doc:id="7afab6c4-4c08-4a23-b21f-cc8a3302f365" variableName="setFilter" />
		<json-logger:logger doc:name="Received Request for the picklist" doc:id="ed4f1279-3494-446a-a0dd-a34211c047d4" config-ref="JSON_Logger_Config" message="START get street label" category="${log.external.categoryAdditivityEnabled}" tracePoint="BEFORE_REQUEST">
			<json-logger:content><![CDATA[#[output application/json indent = false 
---
{
setFilter: vars.setFilter}]]]></json-logger:content>
		</json-logger:logger>
		<http:request method="GET" doc:name="GET /picklist" doc:id="c9fa45c1-f457-4702-b8f4-a0de693f211f" config-ref="HTTP_Request_odata" path="${ehr.picklist.path}" sendCorrelationId="ALWAYS" correlationId="#[correlationId]" >
			<http:query-params ><![CDATA[#[output application/java
---
{
	'\$format' : "json",
	'\$filter' : vars.setFilter
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="convert-to-json" doc:id="46d082fb-48d8-4039-b632-72a8775ba667">
			<ee:message>
				<ee:set-payload resource="dwl/convertToJson.dwl" />
			</ee:message>
		</ee:transform>
		<json-logger:logger doc:name="Response for the picklist" doc:id="8bd4f940-cd12-453e-856a-b231d9f78764" config-ref="JSON_Logger_Config" message="Response for the street label" tracePoint="AFTER_REQUEST" priority="DEBUG" category="com.louisvuitton.technical" />
	</sub-flow>
</mule>
